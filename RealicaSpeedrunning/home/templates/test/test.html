<!DOCTYPE html>
<html lang="en">
    <head>
        <body>
            <h3>This is the test page. Choose test:</h3>
            <form method="post" action="/test/">
                {% csrf_token %}
                <button type="submit", name="test-type", value="1881-1890">Saksakeelne kool</button>
                <button type="submit", name="test-type", value="1890-1918">Venestamisaegne kool</button>
                <button type="submit", name="test-type", value="1918-1920">Wabadussõjaaegne kool</button>
                <button type="submit", name="test-type", value="1921-1940">I vabariigiaegne kool</button>
                <button type="submit", name="test-type", value="1941-1950">Sõjaaegne ja sõjajärgne kool</button>
                <button type="submit", name="test-type", value="1951-1960">Nõukogudeaegne kool 50-ndad</button>
                <button type="submit", name="test-type", value="1961-1970">Nõukogudeaegne kool 60-ndad</button>
                <button type="submit", name="test-type", value="1971-1980">Nõukogudeaegne kool 70-ndad</button>
                <button type="submit", name="test-type", value="1981-1990">Nõukogudeaegne kool 80-ndad</button>
                <button type="submit", name="test-type", value="1991-">Taasiseseisvumisjärgne kool</button>
            </form>
            <div>
                <p>
                    {% if text %}
                        <div>
                            {{ text }}
                        </div>
                        {% if not state %}
                        <div>
                            <form method="post" action="/test/">
                                {% csrf_token %}
                                <button type="submit", name="action-start", value="start">Start test</button>
                            </form>
                        </div>
                        {% endif %}
                        {% if state %}
                        <div>
                            <form method="post" action="/test/">
                                {% csrf_token %}
                                <textarea name="usertext" id="usertext" cols="256" rows="10" maxlength="{{maxlen}}" onkeyup="stop()"></textarea>
                                <button type="submit", id="submit", name="action-end", value="end">End test</button>
                            </form>
                        </div>
                        {% endif %}
                        {% if usertext %}
                        <div>
                            <h4>Your results:</h4>
                                <h6>Written text:</h6>
                                    <p>{{ usertext }}</p>
                                <h6>Time:</h6>
                                    <p>{{ timedelta }} seconds</p>
                                <h6>Score:</h6>
                                    <p>{{ score }}%</p>
                                <h6>Words per second:</h6>
                                    <p>{{ speed }} w/s</p>    
                        </div>
                        {% endif %}
                    {% endif %}
                </p>
            </div>
            <script data-maxlen="{{maxlen}}">
                var maxlen = document.currentScript.dataset.maxlen;

                function stop() {
                    var x = document.getElementById("usertext").value;
                    
                    if (x.length >= Number(maxlen)) {
                        document.getElementById('submit').click();
                    }
                }
            </script>
        </body>
    </head>
</html>